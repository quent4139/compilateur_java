<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RegisterManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Deca Compiler</a> &gt; <a href="index.source.html" class="el_package">fr.ensimag.deca.codegen</a> &gt; <span class="el_source">RegisterManager.java</span></div><h1>RegisterManager.java</h1><pre class="source lang-java linenums">package fr.ensimag.deca.codegen;

import fr.ensimag.ima.pseudocode.GPRegister;
import fr.ensimag.ima.pseudocode.Register;
import fr.ensimag.ima.pseudocode.RegisterOffset;
import fr.ensimag.ima.pseudocode.DAddr;
import fr.ensimag.ima.pseudocode.DVal;

/**
 * Register Manager used for the code generation
 * 
 * @author gl37
 * @date 01/17/2022
 */
public class RegisterManager{
    // On va n'utiliser que les registres 3 à 15
    // r2 ne servira qu'à contenir le résultat d'une opération, ce sera notre registre pivot
    private Register register;
    private boolean[] freeRegister;
    private int nb_var; // utile quand on voudra accéeder à la pile quand plus de place dans les registres, c'est pour savoir à partir d'ou on peut utiliser la pile
    private int nb_lb; //utile pour les declarations de variable dans des méthodes

<span class="fc" id="L23">    public RegisterManager(){</span>
<span class="fc" id="L24">        this.register = new Register(&quot;register&quot;); </span>
<span class="fc" id="L25">        this.freeRegister = new boolean[13];</span>
<span class="fc bfc" id="L26" title="All 2 branches covered.">        for(int i = 0; i &lt; 13; i++){</span>
<span class="fc" id="L27">            freeRegister[i] = true;</span>
        } 
<span class="fc" id="L29">        this.nb_var = 1; </span>
<span class="fc" id="L30">        this.nb_lb = 1;</span>
<span class="fc" id="L31">    }</span>

    public GPRegister getRegister(){
<span class="fc" id="L34">        int i = 0;</span>
<span class="fc bfc" id="L35" title="All 2 branches covered.">        for(boolean b : this.freeRegister){</span>
<span class="fc bfc" id="L36" title="All 2 branches covered.">            if(freeRegister[i]){</span>
<span class="fc" id="L37">                break;</span>
            }
<span class="fc" id="L39">            i ++;</span>
        }
<span class="pc bpc" id="L41" title="1 of 4 branches missed.">        if((i == 13) &amp;&amp; (!this.freeRegister[i-1])){ // plus de registre disponible</span>
<span class="fc" id="L42">            return null;</span>
        }
        else{
<span class="fc" id="L45">            this.freeRegister[i] = false;</span>
<span class="fc" id="L46">            return register.getR(i+3);</span>
        }
    }

    public void declare_nb_var(int i){ 
        // fonction qui sera utilisé dans declvar, qui notera le nombre de variables déclarés dans la pile dans le main
        // permet donc de savoir à partir d'ou on peut utiliser la pile
        // à changer pour la partie objet
<span class="nc" id="L54">        this.nb_var = this.nb_var + i;</span>
<span class="nc" id="L55">    }</span>

    public DAddr getStackMemory(){ // à modifier
        // donne accés à un espace dans la pile
<span class="fc" id="L59">        Register stack_register = register.GB;// à un moment faudra modifier en lb</span>
<span class="fc" id="L60">        int num = this.nb_var; </span>
<span class="fc" id="L61">        DAddr addr = new RegisterOffset(num, stack_register);</span>
<span class="fc" id="L62">        this.nb_var ++; // pas totalement fonctionnel</span>
<span class="fc" id="L63">        return addr;</span>
    }

    public GPRegister getR0(){
<span class="fc" id="L67">        return register.getR(0);</span>
    }

    public GPRegister getR1(){
<span class="fc" id="L71">        return register.getR(1);</span>
    }

    public GPRegister getR2(){
<span class="fc" id="L75">        return register.getR(2);</span>
    }
    
    public void freeRegister(GPRegister register){
        // focntion qui libère un registre
<span class="fc" id="L80">        int num_register = register.getNumber();</span>
<span class="fc" id="L81">        freeRegister[num_register - 3] = true;</span>
<span class="fc" id="L82">    }</span>
    public void freeRegister(RegisterOffset addr){
        // fonction qui notifie qu'on peut utiliser un espace dans la pile
<span class="fc" id="L85">        int i = addr.getOffset();</span>
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">        if(i &lt; this.nb_var){</span>
<span class="fc" id="L87">            this.nb_var = i; // pas vraiment fonctionnel</span>
        }
<span class="fc" id="L89">    }</span>
    public Register getLB(){
<span class="fc" id="L91">        return register.LB;</span>
    }

    public DAddr getLBMemory(){
<span class="nc" id="L95">        Register stack_register = register.LB;</span>
<span class="nc" id="L96">        int num = this.nb_lb; </span>
<span class="nc" id="L97">        DAddr addr = new RegisterOffset(num, stack_register);</span>
<span class="nc" id="L98">        this.nb_lb ++; </span>
<span class="nc" id="L99">        return addr;</span>
    }

    public void freeLBMemory(){
<span class="fc" id="L103">        this.nb_lb = 1;</span>
<span class="fc" id="L104">    }</span>

    public Register getSP(){
<span class="fc" id="L107">        return register.SP;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>